# Pay402 - Cursor AI Rules for Hackathon Development

## ğŸš¨ CRITICAL: Hackathon Commit Strategy

### Rule #1: FREQUENT COMMITS (Every 30-60 Minutes)
**WHY:** Hackathon judges look at git history to verify work was done during event, not pre-written.

**MANDATORY COMMIT FREQUENCY:**
- âœ… Commit EVERY time you complete a logical unit of work
- âœ… Commit BEFORE taking breaks
- âœ… Commit AFTER fixing bugs/errors
- âœ… Commit when switching between components
- âœ… NEVER bulk commit large changes

**EXAMPLES OF GOOD COMMIT PATTERNS:**
```bash
# DO THIS:
git add contracts/Move.toml
git commit -m "chore: initialize Move project structure"

git add contracts/sources/payment.move
git commit -m "feat(contract): add generic Coin<T> struct definitions"

git add contracts/sources/payment.move
git commit -m "feat(contract): implement settle_payment function skeleton"

git add contracts/sources/payment.move
git commit -m "feat(contract): add coin splitting logic"

git add contracts/sources/payment.move
git commit -m "feat(contract): add event emission for PaymentSettled"

git add contracts/tests/payment_tests.move
git commit -m "test(contract): add basic settlement test"

# DON'T DO THIS:
git add contracts/
git commit -m "Add complete contract implementation"  # âŒ TOO BIG!
```

**COMMIT MESSAGE FORMAT:**
```
<type>(<scope>): <subject>

Types:
- feat: New feature
- fix: Bug fix
- refactor: Code restructuring
- test: Adding tests
- docs: Documentation
- chore: Build/tooling changes
- style: Formatting changes
- perf: Performance improvement

Examples:
- feat(widget): add zkLogin Google OAuth integration
- fix(facilitator): correct balance check RPC call
- test(contract): add coin splitting edge cases
- docs(readme): update setup instructions
- chore(deps): add @mysten/sui.js dependency
```

### Rule #2: INCREMENTAL DEVELOPMENT
**Build in small, testable increments:**

1. **Contracts:**
   - Commit: Struct definitions
   - Commit: Function signatures
   - Commit: Function implementations (one at a time)
   - Commit: Tests (one test at a time)
   - Commit: Deployment script

2. **Facilitator:**
   - Commit: Project setup (package.json)
   - Commit: Each endpoint skeleton
   - Commit: Each endpoint implementation
   - Commit: Each service module
   - Commit: Error handling
   - Commit: Tests

3. **Widget:**
   - Commit: Project setup
   - Commit: Each component
   - Commit: zkLogin integration steps
   - Commit: x402 client integration
   - Commit: Styling

### Rule #3: COMMIT BEFORE ASKING AI FOR HELP
**Always commit working code before requesting changes:**
```bash
# Current working state
git add .
git commit -m "chore: checkpoint before refactoring balance check"

# Now safe to experiment with AI suggestions
```

---

## ğŸ’» Development Guidelines

### TypeScript Everywhere
- âœ… All widget code: TypeScript
- âœ… All facilitator code: TypeScript
- âœ… All tests: TypeScript
- âœ… Strict mode enabled
- âœ… No `any` types (use `unknown` if needed)

### Move Contract Guidelines
- âœ… Use generic `Coin<T>` (not USDC-specific)
- âœ… Document security considerations (front-running, etc.)
- âœ… Use `&mut` for coins to prevent front-running
- âœ… Emit events for all state changes
- âœ… Use ephemeral receipts (zero storage cost)

### API Design
- âœ… RESTful endpoints
- âœ… Type-safe request/response interfaces
- âœ… Comprehensive error handling
- âœ… Input validation
- âœ… Rate limiting considerations

### Security First
- âœ… Never log private keys or secrets
- âœ… Validate all user inputs
- âœ… Use nonces to prevent replay attacks
- âœ… Implement token expiration
- âœ… Document all security assumptions

### Testing
- âœ… Write tests as you build (not after)
- âœ… Test happy path first
- âœ… Then test edge cases
- âœ… Test security scenarios
- âœ… Commit tests separately from implementation

---

## ğŸ“ File Organization

### Naming Conventions
- **Files:** `kebab-case.ts` (lowercase with hyphens)
- **Components:** `PascalCase.tsx` (React components)
- **Classes:** `PascalCase` (TypeScript classes)
- **Functions:** `camelCase` (functions, methods)
- **Constants:** `SCREAMING_SNAKE_CASE` (constants)
- **Types/Interfaces:** `PascalCase` (types, interfaces)

### Import Order
```typescript
// 1. External dependencies
import { SuiClient } from '@mysten/sui.js/client';
import express from 'express';

// 2. Internal modules
import { checkBalance } from './services/balance';
import { ZkLoginManager } from './zklogin';

// 3. Types
import type { PaymentRequest } from './types';

// 4. Constants
import { FACILITATOR_FEE } from './constants';
```

---

## ğŸ¯ Code Quality Standards

### DRY (Don't Repeat Yourself)
- Extract repeated logic into functions
- Use shared types/interfaces
- Create utility functions for common operations

### Error Handling
```typescript
// âœ… DO THIS:
try {
  const result = await riskyOperation();
  return result;
} catch (error) {
  console.error('Operation failed:', error);
  throw new Error(`Failed to perform operation: ${error.message}`);
}

// âŒ DON'T DO THIS:
try {
  return await riskyOperation();
} catch (error) {
  // Silent failure
}
```

### Async/Await
- âœ… Use async/await (not .then() chains)
- âœ… Handle errors with try/catch
- âœ… Use Promise.all() for parallel operations
- âœ… Add timeouts for external calls

### Comments
```typescript
// âœ… DO THIS:
// Check buyer has sufficient USDC for payment + fee
// Uses devInspectTransactionBlock (off-chain, free)
const balance = await checkBalance(address);

// âŒ DON'T DO THIS:
// Check balance
const balance = await checkBalance(address);
```

---

## ğŸ”§ Configuration

### Environment Variables
```typescript
// Always use environment variables for:
- API keys (Google OAuth client ID)
- RPC endpoints
- Private keys (facilitator keypair)
- Service URLs
- Network selection (testnet/mainnet)

// Never commit:
- .env files (add to .gitignore)
- Private keys
- API secrets
```

### Constants File
```typescript
// constants.ts
export const FACILITATOR_FEE_USDC = 10000; // 0.01 USDC (6 decimals)
export const TOKEN_EXPIRATION_MS = 5 * 60 * 1000; // 5 minutes
export const MAX_RETRIES = 3;
export const CLOCK_ID = '0x6';

// Use constants instead of magic numbers!
```

---

## ğŸ› Debugging

### Logging Best Practices
```typescript
// âœ… Structured logging
console.log('Payment verification started', {
  buyer: address,
  amount: amount,
  timestamp: Date.now()
});

// âŒ Unstructured
console.log('verifying payment');
```

### Development vs Production
```typescript
// Use environment checks
if (process.env.NODE_ENV === 'development') {
  console.log('Debug info:', debugData);
}

// Never log sensitive data in production
```

---

## ğŸ“ Documentation

### Inline Documentation
- Document complex algorithms
- Explain security decisions
- Note any hacks or temporary solutions
- Reference relevant specs/docs

### README Updates
- Update README as features are added
- Keep setup instructions current
- Document known issues
- Add examples

### API Documentation
- Document all endpoints
- Include request/response examples
- Note error codes
- Specify authentication requirements

---

## ğŸš€ Performance

### Optimization Guidelines
- âœ… Use `devInspectTransactionBlock` for read-only operations (free!)
- âœ… Cache zkLogin sessions (avoid re-generating ZK proofs)
- âœ… Batch RPC calls when possible
- âœ… Use async/await properly (don't block unnecessarily)
- âš ï¸ Don't optimize prematurely (get it working first)

### Gas Optimization
- Contract: Use `&mut` instead of owned transfers when possible
- Contract: Prefer ephemeral structs (zero storage)
- Facilitator: Sponsor gas for better UX
- Widget: Minimize RPC calls

---

## âœ… Pre-Commit Checklist

Before EVERY commit, verify:
- [ ] Code compiles/runs without errors
- [ ] No TypeScript errors (`npm run type-check`)
- [ ] No console.errors in production code
- [ ] No TODO comments (fix or create issue)
- [ ] No commented-out code (delete it)
- [ ] Sensitive data removed (keys, secrets)
- [ ] Commit message is descriptive

---

## ğŸ¬ Demo Preparation

### Before Demo Day
- [ ] Test entire flow end-to-end
- [ ] Record demo video (backup)
- [ ] Prepare slides (architecture diagram)
- [ ] Practice 60-second pitch
- [ ] Test on different browsers
- [ ] Deploy to public URL

### During Demo
- [ ] Have backup video ready
- [ ] Clear browser cache before demo
- [ ] Use prepared demo accounts
- [ ] Show git history (proves work during hackathon)

---

## ğŸ“ Learning Resources

### SUI/Move
- SUI Docs: https://docs.sui.io/
- Move Book: https://move-book.com/
- zkLogin Guide: https://docs.sui.io/guides/developer/cryptography/zklogin-integration

### x402 Protocol
- Coinbase Docs: https://docs.cdp.coinbase.com/x402/
- PayAI Docs: https://docs.payai.network/

### TypeScript
- TypeScript Handbook: https://www.typescriptlang.org/docs/handbook/

---

## ğŸ”’ Security Reminders

**NEVER commit:**
- Private keys
- Mnemonics/seed phrases
- API secrets
- OAuth client secrets
- `.env` files

**ALWAYS:**
- Use environment variables
- Validate all inputs
- Implement rate limiting
- Use HTTPS in production
- Log security events

---

## ğŸ“Š Progress Tracking

### Milestones
- [ ] Move contract deployed to testnet
- [ ] Facilitator API running locally
- [ ] Widget integrated with zkLogin
- [ ] End-to-end payment flow working
- [ ] Demo page deployed
- [ ] Demo video recorded

### Daily Targets (Hackathon)
**Day 1:**
- [ ] Contract implementation (4-6h)
- [ ] Facilitator API skeleton (4h)

**Day 2:**
- [ ] zkLogin integration (4h)
- [ ] x402 client implementation (4h)

**Day 3:**
- [ ] Widget UI components (4h)
- [ ] Demo page (2h)

**Day 4:**
- [ ] Testing & bug fixes
- [ ] Demo prep & submission

---

## ğŸ’¡ AI Assistant Guidelines

### When to Use AI
- âœ… Debugging complex errors
- âœ… Optimizing algorithms
- âœ… Learning new APIs
- âœ… Writing boilerplate
- âœ… Reviewing code

### When NOT to Use AI
- âŒ Architecture decisions (discuss with team)
- âŒ Security design (review with experts)
- âŒ Committing code (you verify first)
- âŒ Deployment to production (manual verification)

### AI Best Practices
1. Always review AI-generated code
2. Test before committing
3. Understand what the code does
4. Refactor to match project style
5. Add proper error handling

---

## ğŸ¯ Focus Areas for Hackathon

### High Priority (Must Have)
- âœ… Move contract (generic Coin<T>)
- âœ… Facilitator balance checking
- âœ… Facilitator payment verification
- âœ… zkLogin integration
- âœ… Basic widget UI
- âœ… Demo page with x402 Echo

### Medium Priority (Should Have)
- âš ï¸ Comprehensive error handling
- âš ï¸ Loading states in UI
- âš ï¸ Transaction links in widget
- âš ï¸ Gas sponsorship
- âš ï¸ Nonce tracking

### Low Priority (Nice to Have)
- âŒ Payment channels (defer to post-hackathon)
- âŒ CCTP integration (show diagram only)
- âŒ AI agent mode (mention in pitch)
- âŒ Merchant dashboard (future)
- âŒ Analytics (future)

---

## ğŸ“ Communication

### Commit Messages as Communication
Your git history tells a story:
- Shows your thought process
- Proves work was done during hackathon
- Helps judges understand your approach
- Documents decisions and trade-offs

**Make your commits tell a good story!**

---

**Remember: Frequent, small commits are your friend in a hackathon!** ğŸš€

**Target: 50-100+ commits during the 2-day hackathon**

**Current Status:** Architecture complete, ready to implement
**Next Step:** Initialize git repository and make first commit

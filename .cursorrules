# Pay402 - Cursor AI Rules for Hackathon Development

## üö® CRITICAL #0: FIGHT BLOAT (Code & Documentation)

### Rule #0a: NO DOCUMENTATION BLOAT
**WHY:** Duplicate docs diverge, become untrustworthy, waste time

**MANDATORY RULES:**
- ‚úÖ ONE topic = ONE file (single source of truth)
- ‚úÖ Update docs IN PLACE (don't create "v2" or "updated" versions)
- ‚úÖ Delete redundant files IMMEDIATELY
- ‚ùå NEVER create "summary of another doc" files (use git log instead)
- ‚ùå NEVER duplicate information across multiple files
- ‚ùå NEVER create "comparison" or "update notes" files (use git commit messages)

**EXAMPLES OF BLOAT TO AVOID:**
```bash
# BAD (will diverge):
docs/ARCHITECTURE.md           # Main doc
docs/ARCHITECTURE_SUMMARY.md   # Summary of main doc ‚ùå
docs/ARCHITECTURE_UPDATES.md   # What changed ‚ùå
docs/ARCHITECTURE_v2.md        # New version ‚ùå

# GOOD (single source):
docs/ARCHITECTURE.md           # One file, updated in place ‚úÖ
git log docs/ARCHITECTURE.md   # See what changed ‚úÖ
```

**WHEN TO CREATE NEW DOC:**
- ‚úÖ Different PURPOSE (e.g., ARCHITECTURE.md = design, DEVELOPMENT_GUIDE.md = workflow)
- ‚úÖ Different AUDIENCE (e.g., README.md = users, ARCHITECTURE.md = developers)
- ‚ùå NOT for "quick reference" (use TOC in main doc instead)
- ‚ùå NOT for "summary" (git log shows changes)

**ALLOWED DOCS FOR PAY402:**
- `README.md` - Project overview (for users/judges)
- `docs/ARCHITECTURE.md` - Design decisions (what & why)
- `docs/DEVELOPMENT_GUIDE.md` - Build workflow (how & when)
- `docs/WIDGET_DEPLOYMENT.md` - Specific deployment topic (focused reference)
- `CHECKLIST.md` - Task tracking (active, deleted when done)
- **NOTHING ELSE!**

### Rule #0b: NO CODE BLOAT
**WHY:** Unused code confuses, slows down, creates bugs

**MANDATORY RULES:**
- ‚úÖ Write MINIMAL code that works
- ‚úÖ Delete unused functions/imports IMMEDIATELY
- ‚úÖ One function = one purpose (no multi-purpose helpers)
- ‚ùå NO "just in case" code (YAGNI - You Ain't Gonna Need It)
- ‚ùå NO premature abstraction (wait until you need it 3 times)
- ‚ùå NO commented-out code (delete it, git remembers)

**EXAMPLES:**
```typescript
// BAD (bloated):
function processPayment(data, options = {}) {
  // Handle multiple payment types (only need one!)
  if (options.type === 'card') { ... }      // ‚ùå Unused
  if (options.type === 'crypto') { ... }    // ‚úÖ Only this used
  if (options.type === 'paypal') { ... }    // ‚ùå Unused
  
  // Old implementation (commented out)
  // const oldWay = ...  // ‚ùå DELETE THIS!
}

// GOOD (minimal):
function processPayment(data) {
  // Only handle crypto (what we actually need)
  return handleCryptoPayment(data);
}
```

### Rule #0c: TEST WHAT YOU BUILD, WHEN YOU BUILD IT
**WHY:** Untested code breaks later, wastes time debugging

**MANDATORY RULES:**
- ‚úÖ Test EACH function BEFORE moving to next
- ‚úÖ Add test BEFORE committing feature
- ‚úÖ Run full test suite BEFORE pushing
- ‚ùå NO "I'll test it later" (you won't)
- ‚ùå NO untested code in commits
- ‚ùå NO skipping tests because "it's simple" (simple code breaks too)

**WORKFLOW:**
```bash
# 1. Write function
vim payment.move

# 2. Write test IMMEDIATELY
vim payment_tests.move

# 3. Run test
sui move test

# 4. Only commit when test passes
git add payment.move payment_tests.move
git commit -m "feat: add settle_payment with unit test"

# NEVER do this:
git add payment.move
git commit -m "feat: add settle_payment (will test later)"  # ‚ùå
```

---

## üö® CRITICAL #1: Hackathon Commit Strategy

### Rule #1: FREQUENT COMMITS (Every 30-60 Minutes)
**WHY:** Hackathon judges look at git history to verify work was done during event, not pre-written.

**MANDATORY COMMIT FREQUENCY:**
- ‚úÖ Commit EVERY time you complete a logical unit of work
- ‚úÖ Commit BEFORE taking breaks
- ‚úÖ Commit AFTER fixing bugs/errors
- ‚úÖ Commit when switching between components
- ‚úÖ NEVER bulk commit large changes

**EXAMPLES OF GOOD COMMIT PATTERNS:**
```bash
# DO THIS:
git add contracts/Move.toml
git commit -m "chore: initialize Move project structure"

git add contracts/sources/payment.move
git commit -m "feat(contract): add generic Coin<T> struct definitions"

git add contracts/sources/payment.move
git commit -m "feat(contract): implement settle_payment function skeleton"

git add contracts/sources/payment.move
git commit -m "feat(contract): add coin splitting logic"

git add contracts/sources/payment.move
git commit -m "feat(contract): add event emission for PaymentSettled"

git add contracts/tests/payment_tests.move
git commit -m "test(contract): add basic settlement test"

# DON'T DO THIS:
git add contracts/
git commit -m "Add complete contract implementation"  # ‚ùå TOO BIG!
```

**COMMIT MESSAGE FORMAT:**
```
<type>(<scope>): <subject>

Types:
- feat: New feature
- fix: Bug fix
- refactor: Code restructuring
- test: Adding tests
- docs: Documentation
- chore: Build/tooling changes
- style: Formatting changes
- perf: Performance improvement

Examples:
- feat(widget): add zkLogin Google OAuth integration
- fix(facilitator): correct balance check RPC call
- test(contract): add coin splitting edge cases
- docs(readme): update setup instructions
- chore(deps): add @mysten/sui.js dependency
```

### Rule #2: INCREMENTAL DEVELOPMENT
**Build in small, testable increments:**

1. **Contracts:**
   - Commit: Struct definitions
   - Commit: Function signatures
   - Commit: Function implementations (one at a time)
   - Commit: Tests (one test at a time)
   - Commit: Deployment script

2. **Facilitator:**
   - Commit: Project setup (package.json)
   - Commit: Each endpoint skeleton
   - Commit: Each endpoint implementation
   - Commit: Each service module
   - Commit: Error handling
   - Commit: Tests

3. **Widget:**
   - Commit: Project setup
   - Commit: Each component
   - Commit: zkLogin integration steps
   - Commit: x402 client integration
   - Commit: Styling

### Rule #3: COMMIT BEFORE ASKING AI FOR HELP
**Always commit working code before requesting changes:**
```bash
# Current working state
git add .
git commit -m "chore: checkpoint before refactoring balance check"

# Now safe to experiment with AI suggestions
```

---

## üíª Development Guidelines

### TypeScript Everywhere
- ‚úÖ All widget code: TypeScript
- ‚úÖ All facilitator code: TypeScript
- ‚úÖ All tests: TypeScript
- ‚úÖ Strict mode enabled
- ‚úÖ No `any` types (use `unknown` if needed)

### Move Contract Guidelines
- ‚úÖ Use generic `Coin<T>` (not USDC-specific)
- ‚úÖ Document security considerations (front-running, etc.)
- ‚úÖ Use `&mut` for coins to prevent front-running
- ‚úÖ Emit events for all state changes
- ‚úÖ Use ephemeral receipts (zero storage cost)

### API Design
- ‚úÖ RESTful endpoints
- ‚úÖ Type-safe request/response interfaces
- ‚úÖ Comprehensive error handling
- ‚úÖ Input validation
- ‚úÖ Rate limiting considerations

### Security First
- ‚úÖ Never log private keys or secrets
- ‚úÖ Validate all user inputs
- ‚úÖ Use nonces to prevent replay attacks
- ‚úÖ Implement token expiration
- ‚úÖ Document all security assumptions

### Testing
- ‚úÖ Write tests as you build (not after)
- ‚úÖ Test happy path first
- ‚úÖ Then test edge cases
- ‚úÖ Test security scenarios
- ‚úÖ Commit tests separately from implementation

---

## üìÅ File Organization

### Naming Conventions
- **Files:** `kebab-case.ts` (lowercase with hyphens)
- **Components:** `PascalCase.tsx` (React components)
- **Classes:** `PascalCase` (TypeScript classes)
- **Functions:** `camelCase` (functions, methods)
- **Constants:** `SCREAMING_SNAKE_CASE` (constants)
- **Types/Interfaces:** `PascalCase` (types, interfaces)

### Import Order
```typescript
// 1. External dependencies
import { SuiClient } from '@mysten/sui.js/client';
import express from 'express';

// 2. Internal modules
import { checkBalance } from './services/balance';
import { ZkLoginManager } from './zklogin';

// 3. Types
import type { PaymentRequest } from './types';

// 4. Constants
import { FACILITATOR_FEE } from './constants';
```

---

## üéØ Code Quality Standards

### DRY (Don't Repeat Yourself)
- Extract repeated logic into functions
- Use shared types/interfaces
- Create utility functions for common operations

### Error Handling
```typescript
// ‚úÖ DO THIS:
try {
  const result = await riskyOperation();
  return result;
} catch (error) {
  console.error('Operation failed:', error);
  throw new Error(`Failed to perform operation: ${error.message}`);
}

// ‚ùå DON'T DO THIS:
try {
  return await riskyOperation();
} catch (error) {
  // Silent failure
}
```

### Async/Await
- ‚úÖ Use async/await (not .then() chains)
- ‚úÖ Handle errors with try/catch
- ‚úÖ Use Promise.all() for parallel operations
- ‚úÖ Add timeouts for external calls

### Comments
```typescript
// ‚úÖ DO THIS:
// Check buyer has sufficient USDC for payment + fee
// Uses devInspectTransactionBlock (off-chain, free)
const balance = await checkBalance(address);

// ‚ùå DON'T DO THIS:
// Check balance
const balance = await checkBalance(address);
```

---

## üîß Configuration

### Environment Variables
```typescript
// Always use environment variables for:
- API keys (Google OAuth client ID)
- RPC endpoints
- Private keys (facilitator keypair)
- Service URLs
- Network selection (testnet/mainnet)

// Never commit:
- .env files (add to .gitignore)
- Private keys
- API secrets
```

### Constants File
```typescript
// constants.ts
export const FACILITATOR_FEE_USDC = 10000; // 0.01 USDC (6 decimals)
export const TOKEN_EXPIRATION_MS = 5 * 60 * 1000; // 5 minutes
export const MAX_RETRIES = 3;
export const CLOCK_ID = '0x6';

// Use constants instead of magic numbers!
```

---

## üêõ Debugging

### Logging Best Practices
```typescript
// ‚úÖ Structured logging
console.log('Payment verification started', {
  buyer: address,
  amount: amount,
  timestamp: Date.now()
});

// ‚ùå Unstructured
console.log('verifying payment');
```

### Development vs Production
```typescript
// Use environment checks
if (process.env.NODE_ENV === 'development') {
  console.log('Debug info:', debugData);
}

// Never log sensitive data in production
```

---

## üìù Documentation

### Inline Documentation
- Document complex algorithms
- Explain security decisions
- Note any hacks or temporary solutions
- Reference relevant specs/docs

### README Updates
- Update README as features are added
- Keep setup instructions current
- Document known issues
- Add examples

### API Documentation
- Document all endpoints
- Include request/response examples
- Note error codes
- Specify authentication requirements

---

## üöÄ Performance

### Optimization Guidelines
- ‚úÖ Use `devInspectTransactionBlock` for read-only operations (free!)
- ‚úÖ Cache zkLogin sessions (avoid re-generating ZK proofs)
- ‚úÖ Batch RPC calls when possible
- ‚úÖ Use async/await properly (don't block unnecessarily)
- ‚ö†Ô∏è Don't optimize prematurely (get it working first)

### Gas Optimization
- Contract: Use `&mut` instead of owned transfers when possible
- Contract: Prefer ephemeral structs (zero storage)
- Facilitator: Sponsor gas for better UX
- Widget: Minimize RPC calls

---

## ‚úÖ Pre-Commit Checklist

Before EVERY commit, verify:
- [ ] Code compiles/runs without errors
- [ ] No TypeScript errors (`npm run type-check`)
- [ ] No console.errors in production code
- [ ] No TODO comments (fix or create issue)
- [ ] No commented-out code (delete it)
- [ ] Sensitive data removed (keys, secrets)
- [ ] Commit message is descriptive

---

## üé¨ Demo Preparation

### Before Demo Day
- [ ] Test entire flow end-to-end
- [ ] Record demo video (backup)
- [ ] Prepare slides (architecture diagram)
- [ ] Practice 60-second pitch
- [ ] Test on different browsers
- [ ] Deploy to public URL

### During Demo
- [ ] Have backup video ready
- [ ] Clear browser cache before demo
- [ ] Use prepared demo accounts
- [ ] Show git history (proves work during hackathon)

---

## üéì Learning Resources

### SUI/Move
- SUI Docs: https://docs.sui.io/
- Move Book: https://move-book.com/
- zkLogin Guide: https://docs.sui.io/guides/developer/cryptography/zklogin-integration

### x402 Protocol
- Coinbase Docs: https://docs.cdp.coinbase.com/x402/
- PayAI Docs: https://docs.payai.network/

### TypeScript
- TypeScript Handbook: https://www.typescriptlang.org/docs/handbook/

---

## üîí Security Reminders

**NEVER commit:**
- Private keys
- Mnemonics/seed phrases
- API secrets
- OAuth client secrets
- `.env` files

**ALWAYS:**
- Use environment variables
- Validate all inputs
- Implement rate limiting
- Use HTTPS in production
- Log security events

---

## üìä Progress Tracking

### Milestones
- [ ] Move contract deployed to testnet
- [ ] Facilitator API running locally
- [ ] Widget integrated with zkLogin
- [ ] End-to-end payment flow working
- [ ] Demo page deployed
- [ ] Demo video recorded

### Daily Targets (Hackathon)
**Day 1:**
- [ ] Contract implementation (4-6h)
- [ ] Facilitator API skeleton (4h)

**Day 2:**
- [ ] zkLogin integration (4h)
- [ ] x402 client implementation (4h)

**Day 3:**
- [ ] Widget UI components (4h)
- [ ] Demo page (2h)

**Day 4:**
- [ ] Testing & bug fixes
- [ ] Demo prep & submission

---

## üí° AI Assistant Guidelines

### When to Use AI
- ‚úÖ Debugging complex errors
- ‚úÖ Optimizing algorithms
- ‚úÖ Learning new APIs
- ‚úÖ Writing boilerplate
- ‚úÖ Reviewing code

### When NOT to Use AI
- ‚ùå Architecture decisions (discuss with team)
- ‚ùå Security design (review with experts)
- ‚ùå Committing code (you verify first)
- ‚ùå Deployment to production (manual verification)

### AI Best Practices
1. Always review AI-generated code
2. Test before committing
3. Understand what the code does
4. Refactor to match project style
5. Add proper error handling

---

## üéØ Focus Areas for Hackathon

### High Priority (Must Have)
- ‚úÖ Move contract (generic Coin<T>)
- ‚úÖ Facilitator balance checking
- ‚úÖ Facilitator payment verification
- ‚úÖ zkLogin integration
- ‚úÖ Basic widget UI
- ‚úÖ Demo page with x402 Echo

### Medium Priority (Should Have)
- ‚ö†Ô∏è Comprehensive error handling
- ‚ö†Ô∏è Loading states in UI
- ‚ö†Ô∏è Transaction links in widget
- ‚ö†Ô∏è Gas sponsorship
- ‚ö†Ô∏è Nonce tracking

### Low Priority (Nice to Have)
- ‚ùå Payment channels (defer to post-hackathon)
- ‚ùå CCTP integration (show diagram only)
- ‚ùå AI agent mode (mention in pitch)
- ‚ùå Merchant dashboard (future)
- ‚ùå Analytics (future)

---

## üìû Communication

### Commit Messages as Communication
Your git history tells a story:
- Shows your thought process
- Proves work was done during hackathon
- Helps judges understand your approach
- Documents decisions and trade-offs

**Make your commits tell a good story!**

---

**Remember: Frequent, small commits are your friend in a hackathon!** üöÄ

**Target: 50-100+ commits during the 2-day hackathon**

**Current Status:** Architecture complete, ready to implement
**Next Step:** Initialize git repository and make first commit
